//test
#include "BaseVSShader.h"

#include "PassThrough_vs30.inc" 
#include "post_vignette_ps30.inc"
 //files generated by compiling the fxc files

ConVar mat_vignette_inner_radius("mat_vignette_inner_radius", "0.2", FCVAR_ARCHIVE, "Inner range for Vignette");
ConVar mat_vignette_outer_radius("mat_vignette_outer_radius", "1.8", FCVAR_ARCHIVE, "Outer range for Vignette");

BEGIN_VS_SHADER( Post_Vignette, "Help for Post_Vignette" ) //Begin the shader
 
	BEGIN_SHADER_PARAMS
	
//	SHADER_PARAM(INNER_RADIUS, SHADER_PARAM_TYPE_FLOAT, ".2", "")
//	SHADER_PARAM(OUTER_RADIUS, SHADER_PARAM_TYPE_FLOAT, "1.2", "")
	SHADER_PARAM( FBTEXTURE, SHADER_PARAM_TYPE_TEXTURE, "_rt_FullFrameFB", "" )

	END_SHADER_PARAMS
  
	SHADER_FALLBACK
	{
		return 0;
	}
 

	SHADER_INIT //initializes the shader
	{
		if( params[FBTEXTURE]->IsDefined() )
		{
			LoadTexture( FBTEXTURE );
		}
	}
 
	SHADER_DRAW
	{
		SHADOW_STATE
		{
			pShaderShadow->EnableDepthWrites( false );
			
			//pShaderShadow->EnableTexture( SHADER_TEXTURE_STAGE0, true ); //enables SHADER_TEXTURE_STAGE0
			pShaderShadow->EnableTexture( SHADER_SAMPLER0, true ); //enables SHADER_TEXTURE_STAGE0
 
			//depth writes aren't needed 
			int fmt = VERTEX_POSITION;
			//pShaderShadow->VertexShaderVertexFormat( fmt, 1, 0, 0, 0 ); //sets the vertex format for the .fxc
			pShaderShadow->VertexShaderVertexFormat( fmt, 1, 0, 0 ); //sets the vertex format for the .fxc
			pShaderShadow->SetVertexShader( "PassThrough_vs30", 0 ); //set the vertex shader
			pShaderShadow->SetPixelShader( "post_vignette_ps30" ); //set the pixel shader
			//pShaderShadow->EnableAlphaWrites( true );	
			//pShaderShadow->EnableBlending(true);
			//DECLARE_STATIC_VERTEX_SHADER( PassThrough_vs20 );
			//SET_STATIC_VERTEX_SHADER( PassThrough_vs20 );

			//DECLARE_STATIC_PIXEL_SHADER( post_nightvision_ps20 );
			//SET_STATIC_PIXEL_SHADER( post_nightvision_ps20 );

			DefaultFog();
		}

		DYNAMIC_STATE
		{
			
			float innerRadius = mat_vignette_inner_radius.GetFloat();
			float outerRadius = mat_vignette_outer_radius.GetFloat();

			pShaderAPI->SetPixelShaderConstant(0, &innerRadius);
			pShaderAPI->SetPixelShaderConstant(1, &outerRadius);
			
			BindTexture( SHADER_SAMPLER0, FBTEXTURE, -1 );
		}
		Draw(); //draw the shader
	}
END_SHADER